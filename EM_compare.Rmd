---
title: "EM_Compare"
author: "ziming"
date: "5/23/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
## Library needed
library(ggpubr)
library(MASS)
library(stats)
library(Matrix)
library(mvtnorm)
library(mixtools)
library(dplyr)
library(stats)
library(fossil)
library(mclust)

## Sourcing file
source('C:/Users/njzmh/OneDrive/Desktop/REM_official/plot_helper.R')
source('C:/Users/njzmh/OneDrive/Desktop/REM_official/rem_core.R')
source('C:/Users/njzmh/OneDrive/Desktop/REM_official/initial_cond.R')
source('C:/Users/njzmh/OneDrive/Desktop/REM_official/simulator.R')
```

# Set Hyperparameters
```{r}
## Set hyperparam
cluster = 2
lam = 2.2
n = 200
```

#
```{r}
## Data Simulation: (For simulation purpose, the dimension is set as 2)
# Data is simulated by multivariate normal plus a set of uniform  
sim_info <- simMultGauss_unif(n = n, 
                              d = 2,
                              cluster = cluster,
                              out_perc = 0.3,
                              out_mag = 2)
sampleMat = as.data.frame(cbind(sim_info$simdata, rep(1:cluster, each=n)))
colnames(sampleMat) = c("X", "Y", "Cluster")
sampleMat$Cluster = as.character(sampleMat$Cluster)
true = as.numeric(sampleMat$Cluster)
ggplot() + geom_point(aes(x = sim_info$simdata[,1], y = sim_info$simdata[,2]))
```

# Create the initial condition
```{r}
## Classifications from Hierarchical Agglomeration
init_cond <- initial_hier(sim_info$simdata, cluster = cluster)
```

# EM results
```{r}
## MCLUST
result_mclust = Mclust(sim_info[["simdata"]], verbose=F, G=cluster, modelNames = "VVV",
                       initialization = list(hcPairs = hc(sim_info[["simdata"]])),
                       control = emControl(tol=c(1.e-6, 1.e-7), itmax=15))
## Standard EM
result_std <- EM_robust(sampleMat =  sim_info$simdata, c = cluster, d=2, lambda = Inf, sigma_str = 'unstr', inits = init_cond)
## Robust EM
result_robust <- EM_robust(sampleMat =  sim_info$simdata, c = cluster, d=2, lambda = lam, sigma_str = 'unstr', inits = init_cond)
## 1. check adjusted randindex
(acc_mcl = rand.index(true, result_mclust$classification))
(acc_std = rand.index(true, as.numeric(result_std$hard_assign)))
(acc_rem = rand.index(true, as.numeric(result_robust$hard_assign)))
```

# Plot of clusters
```{r}
p1 <- plot_mc(result_mclust)
p2 <- plot_rem(result_std, sim_info$simdata)
p3 <- plot_rem(result_robust, sim_info$simdata)
ggarrange(p1,p2, p3,
          labels = c('mclust' ,'standard', 'robust'),
          ncol = 3, nrow = 1)
```






